---
import { 
  Target, Activity, Layers, Terminal, Bell, FileText, Network, Tag as TagIcon, ScrollText,
  Database, Info, FolderTree, Shield, Filter, CheckCircle2, XCircle, AlertTriangle,
  Upload, Rocket, Settings, Search, History, Code, Puzzle, Wrench, Globe, Server,
  Laptop, BookOpen, ExternalLink, Copy, Play, Save, Download, FilePlus, FolderOpen,
  RefreshCw, Diff, GitBranch, Eye, Edit, Trash2, Star, Zap, Clock,
  List, Grid, Table, PanelRight, Link, Unlink, Lock, Key, User,
  FileCode, Braces, Command, Keyboard, Monitor
} from '@lucide/astro';

interface Props {
  title: string;
  icon?: string;
  color?: 'primary' | 'success' | 'warning' | 'danger' | 'muted' | 'blue' | 'green' | 'purple' | 'orange' | 'cyan' | 'default';
  href?: string;
}

const { title, icon, color = 'primary', href } = Astro.props;

// Semantic color mapping
const colorMap: Record<string, string> = {
  // Semantic colors (preferred)
  primary: 'var(--sl-color-primary)',
  success: 'var(--sl-color-success)',
  warning: 'var(--sl-color-warning)',
  danger: 'var(--sl-color-danger)',
  muted: 'var(--sl-color-muted)',
  // Legacy colors (for backward compatibility)
  blue: 'var(--sl-color-primary)',
  green: 'var(--sl-color-success)',
  purple: '#a855f7',
  orange: 'var(--sl-color-warning)',
  cyan: '#06b6d4',
  default: 'var(--sl-color-muted)',
};

// Essential icon mapping
const iconComponents: Record<string, any> = {
  // Navigation & Actions
  target: Target,
  activity: Activity,
  layers: Layers,
  terminal: Terminal,
  play: Play,
  
  // Files & Documents
  bell: Bell,
  'file-text': FileText,
  document: FileText,
  file: FileText,
  'file-code': FileCode,
  'file-plus': FilePlus,
  
  // Network & Connectivity
  network: Network,
  globe: Globe,
  server: Server,
  laptop: Laptop,
  monitor: Monitor,
  
  // Data & Storage
  tag: TagIcon,
  'scroll-text': ScrollText,
  'list-format': ScrollText,
  list: List,
  database: Database,
  
  // Information & Help
  information: Info,
  info: Info,
  
  // Folders & Organization
  folder: FolderTree,
  'folder-open': FolderOpen,
  
  // Security
  shield: Shield,
  lock: Lock,
  key: Key,
  
  // Filters & Settings
  filter: Filter,
  setting: Settings,
  settings: Settings,
  
  // Status & Validation
  'check-circle': CheckCircle2,
  success: CheckCircle2,
  check: CheckCircle2,
  error: XCircle,
  warning: AlertTriangle,
  'alert-triangle': AlertTriangle,
  
  // Actions
  upload: Upload,
  download: Download,
  save: Save,
  copy: Copy,
  edit: Edit,
  trash: Trash2,
  refresh: RefreshCw,
  'refresh-cw': RefreshCw,
  
  // Rocket & Speed
  rocket: Rocket,
  zap: Zap,
  
  // Search & Find
  search: Search,
  
  // History & Time
  history: History,
  clock: Clock,
  
  // Code & Development
  code: Code,
  braces: Braces,
  
  // Books & Documentation
  book: BookOpen,
  
  // UI Components
  puzzle: Puzzle,
  wrench: Wrench,
  
  // External & Links
  external: ExternalLink,
  'external-link': ExternalLink,
  link: Link,
  unlink: Unlink,
  
  // Layout & Panels
  sidebar: PanelRight,
  grid: Grid,
  table: Table,
  
  // Diff & Version Control
  diff: Diff,
  'git-branch': GitBranch,
  lineage: GitBranch,
  
  // Users
  user: User,
  
  // Misc
  eye: Eye,
  view: Eye,
  command: Command,
  keyboard: Keyboard,
  star: Star,
};

const IconComponent = icon ? iconComponents[icon.toLowerCase()] || iconComponents[icon] || Info : null;
const isClickable = !!href;
const Element = href ? 'a' : 'div';
---

<Element 
  class:list={['feature-card', { clickable: isClickable }]} 
  style={`--card-color: ${colorMap[color] || colorMap.primary};`}
  href={href}
>
  {IconComponent && (
    <div class="feature-icon">
      <IconComponent size={22} />
    </div>
  )}
  <div class="feature-content">
    <h4 class="feature-title">
      {title}
      {isClickable && <ExternalLink size={12} class="external-icon" />}
    </h4>
    <div class="feature-description">
      <slot />
    </div>
  </div>
</Element>

<style>
  .feature-card {
    display: flex;
    gap: 1rem;
    padding: var(--card-padding, 1.25rem);
    background: var(--card-bg, var(--sl-color-bg-nav));
    border: 1px solid var(--sl-color-gray-5);
    border-radius: var(--card-radius, 0.75rem);
    transition: border-color 0.2s ease;
    text-decoration: none;
    color: inherit;
    height: 100%;
  }

  .feature-card:hover {
    border-color: var(--sl-color-gray-4);
  }

  .feature-card.clickable {
    cursor: pointer;
  }

  .feature-card.clickable:hover {
    border-color: var(--card-color);
  }

  .feature-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: var(--card-radius-sm, 0.5rem);
    background: color-mix(in srgb, var(--card-color) 15%, transparent);
    color: var(--card-color);
    flex-shrink: 0;
  }

  .feature-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
  }

  .feature-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.25rem 0;
    color: var(--sl-color-white);
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .external-icon {
    opacity: 0.5;
    transition: opacity 0.2s ease;
  }

  .feature-card.clickable:hover .external-icon {
    opacity: 1;
  }

  .feature-description {
    font-size: 0.875rem;
    color: var(--sl-color-gray-3);
    line-height: 1.5;
    flex: 1;
  }

  .feature-description :global(p) {
    margin: 0;
  }

  .feature-description :global(code) {
    background: var(--sl-color-gray-6);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.8125rem;
  }

  .feature-description :global(kbd) {
    display: inline-block;
    padding: 0.125rem 0.375rem;
    font-size: 0.75rem;
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
    color: var(--sl-color-white);
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 0.25rem;
    box-shadow: 0 1px 0 var(--sl-color-gray-5);
  }
</style>
